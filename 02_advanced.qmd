---
## Metadatos -----------------------------
title: "Introducci칩n al an치lisis geoespacial con R"
subtitle: "Parte 2"
author: "Adri치n Cidre Gonz치lez"
institute: "Universidad de C칩rdoba"

## Presentation --------------------------
format: 
  revealjs:
    preview-links: auto
    theme: [serif, 00_assets/styles/serif-style.scss]
    highlight-style: oblivion # Others: haddock, tango, kate
    transition: fade
    fig-align: center

# Slides -----------------------------
title-slide-attributes: 
    data-background-image: 00_assets/figures/logo-geoforest.png, 00_assets/figures/logo-bosque-digital.png
    data-background-repeat: no-repeat
    data-background-position: 15% 90%, 85% 90%
    data-background-size: 20%, 20%
slide-number: true
center-title-slide: true

# Transition ------------------------
transition: fade
transition-speed: slow
background-transition: fade

## Filters -------------------------
lightbox: true
fig-responsive: true
# filters: 
# webr:
#   packages: ["dplyr", "ggplot2", "gapminder", "forcats"]
# revealjs-plugins:
#   - drop
bibliography: references.bib
---

```{r}
#| label: internal_packages
#| include: false
library(pacman)

p_load(sf, terra)
```

{{< include 00_assets/partials/intro-acidre.qmd >}}

# Objetivos

-   3 ejercicios pr치cticos (\~ 30min cada uno)

-   Mapas de distribuci칩n potencial de especies forestales europeas

-   C치lculo de 칈ndice de Humedad de Thornthwaite

-   Procesado de datos del IFN

# Ejercicio 1 {.main-part .unnumbered}

-   Introducci칩n

-   Modelos EU-Trees4F

-   Descarga de datos a trav칠s de `{forestdata}`

-   Generaci칩n de mapas de distribuci칩n potencial de especies forestales europeas bajo escenarios de cambio clim치tico

{{< fa clock size=xl >}} 20min

## Introducci칩n {.special-size}

Cambio clim치tico: cambios a largo plazo de las temperaturas y los patrones clim치ticos.

-   Mec치nica celeste: Ciclos de Milankovitch

-   Ciclo de calentamiento comenzado hace 18,000 a침os

-   Mayor concentraci칩n de GEI

![@zachos2001](00_assets/figures/02-geospatial-R/climate-evolution.png){fig-align="center" width="577"}

## Especies forestales {.special-size}

**Extinciones pasadas**: especies forestales han sufrido extinciones en episodios de cambio clim치tico

**Desajuste clim치tico**: las especies tienen 칩ptimos de temperatura y precipitaci칩n

![Fuente: ChatGPT (GPT-4 model)](00_assets/figures/02-geospatial-R/forest-extinction.PNG){fig-align="center" width="311"}

## Especies forestales

Eventos extremos m치s frecuentes (sequ칤as, incendios, plagas...)

Especies vulnerables vs Especies resistentes

::::: columns
::: {.column width="50%"}
![Incendio en Quiroga, Galicia. Fuente: propia](00_assets/figures/02-geospatial-R/wildfire-galicia.jpg){fig-align="center" width="667"}
:::

::: {.column width="50%"}
![Ataques de *Ips typographus* en Sn캩쬶a (Chequia). Fuente: propia](00_assets/figures/02-geospatial-R/pest-bark-beetle.jpg){fig-align="center" width="667"}
:::
:::::

## Especies forestales

-   **Migraci칩n geogr치fica**: algunas especies se desplazan (lentamente) hacia zonas m치s al norte o elevadas buscando sus 칩ptimos clim치ticos.

-   **Fenolog칤a**: cambios en el momento de floraci칩n, fructificaci칩n.. Afectando ciclos ecol칩gicos

-   **Gesti칩n Forestal Adaptativa**: busca favorecer la resiliencia de los bosques

::::: columns
::: {.column width="50%"}
![*Abies pinsapo*. Fuente: propia](00_assets/figures/02-geospatial-R/pinsapo-image.jpg){fig-align="center" width="225"}
:::

::: {.column width="50%"}
![Ditribuci칩n *A. pinsapo*. Fuente: REDIAM](00_assets/figures/02-geospatial-R/pinsapo-distribution.PNG){fig-align="center" width="484"}
:::
:::::

## EU-Trees4F {.special-size}

-   Modelos de distribuci칩n de especies (`biomod2`)

-   Base de datos pan-europea (EU-Forest) (582,066 ocurrencias)

-   Distribuci칩n actual (2005) y futuras (2035, 2065, 2095)

-   Escenarios: RCP 4.5 y RCP 8.5

-   10km de resoluci칩n espacial

![@strona2016; @mauri2017](00_assets/figures/02-geospatial-R/euforest-data.png){fig-cap-location="margin" fig-align="center" width="351"}

## Implementaci칩n en R {.special-size-2}

::::: columns
::: {.column width="80%"}
-   Tipos:

    -   **bin**: mapa de distribuci칩n binario. 0 = ausente; 1 = presente

    -   **prob**: mapa de probabilidad de ocurrencia

-   Distribuci칩n:

    -   **pot**: distribuci칩n potencial

    -   **nat**: nicho realizado
:::

::: {.column width="20%"}
![](00_assets/figures/02-geospatial-R/package-forestdata.png){width="200"}
:::
:::::

```{r}
#| eval: false
#| code-line-numbers: "1-8|2|3|4|5|6|7"
ppinaster_rcp45_sr <- fd_forest_eutrees4f(
  species  = "Pinus pinaster",
  model    = "clim",
  period   = "all",
  scenario = "rcp45",
  type     = "bin",
  distrib  = "pot"
)
```

## 游눩 Pr치ctica 1 {.exercise}

-   Paquetes a utilizar:

    -   `forestdata`: descarga de datos de EU-Trees4F

    -   `terra`: manipulaci칩n de datos r치ster

    -   `sf`: paquete base para an치lisis de datos vectoriales

    -   `tidyverse`: paquetes para an치lisis y visualizaci칩n de datos

![](00_assets/figures/02-geospatial-R/ws1-result.png){fig-align="center" width="550"}

# Ejercicio 2 {.main-part .unnumbered}

-   Introducci칩n

-   Indice de Humedad de Thornthwaite

-   Indice de Humedad de Willmott y Feddema

-   C치lculo de los 칤ndices en R

{{< fa clock size=xl >}} 30min

## Introducci칩n

**Sequ칤a**: se produce cuando la disponibilidad de agua no es suficiente para abastecer a los seres vivos.

![Fuente: Forest Research, UK](00_assets/figures/02-geospatial-R/drought-forestresearch.jpg){fig-align="center"}

## Riesgos de la sequ칤a

::: incremental
-   Aumento de la mortalidad de las plantas

-   Vulnerabilidad a plagas (*bark beetles*)

-   Aumento de la biomasa muerta

-   Mayor riesgo de incendio forestal
:::

![Fuente: Forest Research, UK](00_assets/figures/02-geospatial-R/drought-forestresearch.jpg){fig-align="center"}

## Balance de agua en sistemas forestales

-   Entradas: precipitaci칩n

-   Salidas: evaporaci칩n, transpiraci칩n, interceptaci칩n, escorrent칤a

![](00_assets/figures/02-geospatial-R/tmi-balance.png){fig-align="center"}

## Moisture Index de Thornthwaite

-   칈ndice clim치tico basado en el balance h칤drico

-   Comparaci칩n d칠ficit/excesos de agua y ETP

$$
I{m} \ = \ I_{h} \ - \ 0.6 \ \cdot \ I_{a}
$$

![](00_assets/figures/02-geospatial-R/tmi-article.png){fig-align="center"}

## Moisture Index de Thornthwaite {.special-size}

::::: columns
::: {.column width="60%"}
-   $I_{m}$ = 칤ndice global de humedad de Thornthwaite

$$
I{m} \ = \ I_{h} \ - \ 0.6 \ \cdot \ I_{a}
$$

-   $I_h$ = 칤ndice de humedad estacional de Thornthwaite

$$
I_h \ = \ \frac{D}{PET} \ \cdot \ 100
$$

-   $I_a$ = 칤ndice de aridez estacional de Thornthwaite

$$
I_h \ = \ \frac{S}{PET} \ \cdot \ 100
$$
:::

::: {.column width="40%"}
Casos de uso:

-   Clima medio de una zona (1990-2020)

-   Clima de un a침o particular (2024)

-   Comparaci칩n clima medio con a침o actual

![Fuente: @thornthwaite1948](00_assets/figures/02-geospatial-R/tmi-table.png){fig-align="center"}
:::
:::::

## Evapotranspiraci칩n Potencial

Total de agua que se evapora y transpiran las plantas.

M칠todo de @georgeh.hargreaves1985:

$$
PET \ = \ 0.0023 \ \cdot \ RA \ \cdot \ (Tmean \ + \ 17.8) \ \cdot \ TD^{0.5}
$$

```{r}
#| eval: false

## radiaci칩n solar
solar_radiation_sr <- envirem::ETsolradRasters(
    rasterTemplate = tmean_sr[[1]],
    year           = 40
)

## Evapotranspiraci칩n potencial
pet_sr <- envirem::monthlyPET(
    Tmean = tmean_sr,
    RA    = solar_radiation_sr,
    TD    = temp_range_sr
)
```

## D칠ficit y Surplus

-   D칠ficit: se produce cuando precipitaci칩n \< PET

-   Surplus: se produce cuando precipitaci칩n \> PET

![](00_assets/figures/02-geospatial-R/tmi-isdeficit.png){fig-align="center"}

## Moisture Index de @willmott1992 {.special-size}

-   Indice de mejor interpretaci칩n (-1, 1)

-   Incluido en el paquete `envirem`

```{r}
#| eval: false
cmi_sr <- envirem::climaticMoistureIndex(
    annualPrecip = prep_sr,
    PET          = pet_sr
)
```

| Tipo       | 칈ndice de Humedad |
|------------|-------------------|
| Saturado   | 0.66 a 1          |
| Muy h칰medo | 0.33 a 0.66       |
| H칰medo     | 0 a 0.33          |
| Seco       | -0.33 a 0         |
| Semi치rido  | -0.66 a -0.33     |
| 츼rido      | -1 a -0.66        |

: Tipos de Humedad seg칰n @feddema2005

## Worldclim 2.1

::: {.incremental}

* Base de datos global de datos clim치ticos

* Ampliamente utilizados para mapas y modelos (>15,000 citas desde 2017)

* `{geodata}`: descarga de modelos 1970-2000

* Temperatura (m칤nima, media, m치xima), precipitaci칩n...

:::

## 游눩 Pr치ctica 2a {.exercise}

-   Paquetes a utilizar:

    -   `envirem`: c치lculo de 칤ndices bioclim치ticos

    -   `geodata`: descarga de datos de Worldclim

    -   `giscoR`: descarga de l칤mites de CCAA de Espa침a

    -   `sf`, `terra`, `tidyverse`: paquetes base

::::: columns
::: {.column width="50%"}
![](00_assets/figures/02-geospatial-R/tmi-result-map.png){fig-align="center" width="400"}
:::

::: {.column width="50%"}
![](00_assets/figures/02-geospatial-R/tmi-result-graph.png){fig-align="center" width="490"}
:::
:::::

## 游눩 Pr치ctica 2b {.exercise}

-   Paquetes a utilizar:

    -   `envirem`: c치lculo de 칤ndices bioclim치ticos

    -   `geodata`: descarga de datos de Worldclim

    -   `giscoR`: descarga de l칤mites de CCAA de Espa침a

    -   `sf`, `terra`, `tidyverse`: paquetes base

::::: columns
::: {.column width="50%"}
![](00_assets/figures/02-geospatial-R/cmi-result-map.png){fig-align="center" width="480"}
:::

::: {.column width="50%"}
![](00_assets/figures/02-geospatial-R/cmi-result-graph.png){fig-align="center" width="480"}
:::
:::::

## Referencias
